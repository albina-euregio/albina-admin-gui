<div>
  <div class="card">
    <form #updateUserForm="ngForm" appPasswordMismatch>
      <div class="card-body">
        <div class="form-group row">
          <label for="inputName" class="col-sm-2 col-form-label">{{
            "admin.createUser.table.image" | translate
          }}</label>
          <div class="col-sm-10">
            <img src="{{ authenticationService.getUserImageSanitized(activeImage) }}" />
            <input type="file" (change)="onImageChanged($event)" />
          </div>
        </div>
        <div class="form-group row">
          <label for="inputName" class="col-sm-2 col-form-label">{{ "admin.createUser.table.name" | translate }}</label>
          <div class="col-sm-10">
            <input
              required
              type="text"
              #name="ngModel"
              class="form-control"
              id="inputName"
              name="name"
              [(ngModel)]="activeName"
              placeholder="{{ 'admin.createUser.table.name' | translate }}"
            />
            @if (name.invalid && (name.dirty || name.touched)) {
              <div class="alert alert-danger">
                @if (name.errors.required) {
                  <div>
                    {{ "admin.createUser.error.name.required" | translate }}
                  </div>
                }
              </div>
            }
          </div>
        </div>
        <div class="form-group row">
          <label for="inputEmail" class="col-sm-2 col-form-label">{{
            "admin.createUser.table.email" | translate
          }}</label>
          <div class="col-sm-10">
            <input
              required
              email
              type="email"
              #email="ngModel"
              [disabled]="update"
              class="form-control"
              id="inputEmail"
              name="email"
              [(ngModel)]="activeEmail"
              placeholder="{{ 'admin.createUser.table.email' | translate }}"
            />
            @if (email.invalid && (email.dirty || email.touched)) {
              <div class="alert alert-danger">
                @if (email.errors.required) {
                  <div>
                    {{ "admin.createUser.error.email.required" | translate }}
                  </div>
                }
                @if (email.errors.email) {
                  <div>
                    {{ "admin.createUser.error.email.invalid" | translate }}
                  </div>
                }
              </div>
            }
          </div>
        </div>
        @if (!update) {
          <div class="form-group row">
            <label for="inputPassword" class="col-sm-2 col-form-label">{{
              "admin.createUser.table.password" | translate
            }}</label>
            <div class="col-sm-10">
              <input
                type="password"
                autocomplete="off"
                #password="ngModel"
                [disabled]="update"
                class="form-control"
                id="inputPassword"
                name="password"
                [(ngModel)]="activePassword"
                placeholder="{{ 'admin.createUser.table.password' | translate }}"
              />
              @if (!update && password.invalid && (password.dirty || password.touched)) {
                <div class="alert alert-danger">
                  @if (password.errors.required) {
                    <div>
                      {{ "admin.createUser.error.password.required" | translate }}
                    </div>
                  }
                  @if (password.errors.minlength) {
                    <div>
                      {{ "admin.createUser.error.password.length" | translate }}
                    </div>
                  }
                </div>
              }
            </div>
          </div>
        }
        @if (!update) {
          <div class="form-group row">
            <label for="inputPassword2" class="col-sm-2 col-form-label">{{
              "admin.createUser.table.password2" | translate
            }}</label>
            <div class="col-sm-10">
              <input
                type="password"
                autocomplete="off"
                #password2="ngModel"
                class="form-control"
                id="inputPassword2"
                name="password2"
                [(ngModel)]="activePassword2"
                placeholder="{{ 'admin.createUser.table.password' | translate }}"
              />
              @if (
                !update && updateUserForm.errors?.passwordMismatch && (updateUserForm.touched || updateUserForm.dirty)
              ) {
                <div class="cross-validation-error-message alert alert-danger">
                  {{ "admin.createUser.error.password.mismatch" | translate }}
                </div>
              }
            </div>
          </div>
        }
        <div class="form-group row">
          <label for="inputOrganization" class="col-sm-2 col-form-label">{{
            "admin.createUser.table.organization" | translate
          }}</label>
          <div class="col-sm-10">
            <input
              type="text"
              class="form-control"
              id="inputOrganization"
              name="organization"
              [(ngModel)]="activeOrganization"
              placeholder="{{ 'admin.createUser.table.organization' | translate }}"
            />
          </div>
        </div>
        @if (isAdmin) {
          <div class="form-group row">
            <div class="col-sm-2">{{ "admin.createUser.table.roles" | translate }}</div>
            <div class="col-sm-10">
              @for (role of roles; track role) {
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="{{ 'role' + role }}"
                    [checked]="activeRoles.includes(role)"
                    (change)="onRoleSelectionChange(role)"
                  />
                  <label class="form-check-label" for="{{ 'role' + role }}">
                    {{ "role." + role | translate }}
                  </label>
                </div>
              }
            </div>
          </div>
        }
        @if (isAdmin) {
          <div class="form-group row">
            <div class="col-sm-2">{{ "admin.createUser.table.regions" | translate }}</div>
            <div class="col-sm-10">
              @for (region of regions; track region) {
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="{{ 'region' + region }}"
                    [checked]="activeRegions.includes(region)"
                    (change)="onRegionSelectionChange(region)"
                  />
                  <label class="form-check-label" for="{{ 'region' + region }}">
                    {{ regionsService.getRegionName(region) }} ({{ region }})
                  </label>
                </div>
              }
            </div>
          </div>
        }
      </div>
      <!-- Footer -->
      <div class="card-footer">
        <div class="d-grid gap-2 d-md-block">
          @if (!update) {
            <button
              [disabled]="!updateUserForm.valid"
              type="submit"
              class="btn btn-sm btn-primary px-3 mx-1"
              (click)="saveUser()"
            >
              {{ "admin.createUser.button.create" | translate }}
            </button>
          }
          @if (update) {
            <button
              [disabled]="!updateUserForm.valid"
              type="submit"
              class="btn btn-sm btn-primary px-3 mx-1"
              (click)="saveUser()"
            >
              {{ "admin.createUser.button.update" | translate }}
            </button>
          }
          <button type="button" class="btn btn-sm btn-secondary px-3 mx-1" (click)="closeDialog('')">
            {{ "admin.createUser.button.cancel" | translate }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
